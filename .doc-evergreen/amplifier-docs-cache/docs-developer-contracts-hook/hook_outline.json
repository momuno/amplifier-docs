{
  "_meta": {
    "name": "hook-contract-outline",
    "description": "Technical specification and contract for implementing hooks in the Amplifier system for observability and control",
    "use_case": "Reference documentation for developers implementing hooks to observe, validate, and control operations in Amplifier",
    "quadrant": "reference",
    "estimated_lines": "300-400 lines",
    "generation_method": "forward",
    "doc_type": "reference",
    "user_intent": "Provide the complete hook contract specification including protocol, data structures, actions, and implementation patterns"
  },
  "document": {
    "title": "Hook Contract",
    "output": "developer-contracts-hook.md",
    "sections": [
      {
        "heading": "# Hook Contract",
        "level": 1,
        "prompt": "Introduce the Hook Contract, explaining that hooks observe, validate, and control operations in Amplifier. Provide a brief overview of the hook system's capabilities.",
        "sources": [
          {
            "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
            "reasoning": "Lines 23-27 provide the primary introduction stating that hooks observe, validate, and control agent lifecycle events"
          }
        ],
        "sections": [
          {
            "heading": "## Purpose",
            "level": 2,
            "prompt": "Explain the purpose of hooks and how they participate in the agent's cognitive loop. List the key capabilities: observing events, blocking operations, modifying data, injecting context, and requesting approval.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "Lines 29-37 explicitly define the purpose section listing all five hook capabilities: observation, validation, feedback injection, approval gates, and output control"
              }
            ],
            "sections": []
          },
          {
            "heading": "## Protocol",
            "level": 2,
            "prompt": "Define the HookHandler protocol interface using Python Protocol syntax. Show the async __call__ method signature with event and data parameters returning HookResult.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "Lines 53-72 contain the complete Protocol definition with @runtime_checkable decorator, async __call__ signature, and detailed docstring explaining the event handler interface"
              }
            ],
            "sections": []
          },
          {
            "heading": "## HookResult",
            "level": 2,
            "prompt": "Document the complete HookResult data structure with all fields including action, reason, data, context_injection fields, approval fields, and output control fields. Show the structure as a class definition with type annotations.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "Lines 76-110 document HookResult with the complete action table and example code for all action types including their field usage patterns"
              }
            ],
            "sections": []
          },
          {
            "heading": "## Mount Function",
            "level": 2,
            "prompt": "Explain how hooks register handlers using the mount function pattern. Show the async mount function signature that takes coordinator and config parameters, demonstrates registering handlers for events with priority, and returns a cleanup function.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "Lines 114-149 provide the complete mount function pattern including signature, registration examples with priority, cleanup function pattern, and pyproject.toml entry point configuration"
              }
            ],
            "sections": []
          },
          {
            "heading": "## Actions",
            "level": 2,
            "prompt": "Introduce the different action types that hooks can return through HookResult. Provide a brief overview that the following subsections detail each action type.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "Lines 76-110 contain the actions table and all action examples, providing the comprehensive overview of available actions"
              },
              {
                "file": "hooks.py",
                "reasoning": "Lines 111-186 implement the emit method showing how each action type is processed: deny short-circuits (154-156), modify chains data (158-160), inject_context collects for merging (163-165), and ask_user is preserved (168-170)"
              }
            ],
            "sections": [
              {
                "heading": "### continue",
                "level": 3,
                "prompt": "Explain the 'continue' action which proceeds with no changes. Show example code returning HookResult with action='continue'.",
                "sources": [
                  {
                    "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                    "reasoning": "Line 92 shows the continue action in the table as 'Proceed normally' for observation-only use cases, and line 92 shows the simple example HookResult(action='continue')"
                  }
                ],
                "sections": []
              },
              {
                "heading": "### deny",
                "level": 3,
                "prompt": "Explain the 'deny' action which blocks the operation. Show example code returning HookResult with action='deny' and a reason message.",
                "sources": [
                  {
                    "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                    "reasoning": "Lines 94-95 provide the deny action example with reason field for blocking operations due to validation failure or security concerns"
                  },
                  {
                    "file": "amplifier-core/amplifier_core/hooks.py",
                    "reasoning": "Lines 154-156 show the deny action implementation: it short-circuits execution, logs the denial with reason, and immediately returns the result preventing further handler execution"
                  }
                ],
                "sections": []
              },
              {
                "heading": "### modify",
                "level": 3,
                "prompt": "Explain the 'modify' action which transforms event data. Show example code returning HookResult with action='modify' and modified data dictionary.",
                "sources": [
                  {
                    "file": "amplifier-core/amplifier_core/hooks.py",
                    "reasoning": "Lines 158-160 implement modify action showing data transformation chaining: when a handler returns modified data, it becomes current_data for subsequent handlers, enabling preprocessing and enrichment pipelines"
                  }
                ],
                "sections": []
              },
              {
                "heading": "### inject_context",
                "level": 3,
                "prompt": "Explain the 'inject_context' action which adds content to the conversation. Show example code returning HookResult with action='inject_context', context_injection text, and user_message.",
                "sources": [
                  {
                    "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                    "reasoning": "Lines 98-102 demonstrate inject_context action with context_injection containing detailed feedback (e.g., linter errors) and user_message providing user-friendly summary"
                  },
                  {
                    "file": "amplifier-core/amplifier_core/hooks.py",
                    "reasoning": "Lines 163-165 and 188-219 show inject_context merging: multiple handlers can inject context on the same event, collected into a list, then merged into single result with combined content separated by double newlines"
                  }
                ],
                "sections": []
              },
              {
                "heading": "### ask_user",
                "level": 3,
                "prompt": "Explain the 'ask_user' action which requests approval from the user. Show example code returning HookResult with action='ask_user', approval_prompt, approval_options, and approval_default.",
                "sources": [
                  {
                    "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                    "reasoning": "Lines 104-109 provide the ask_user action example showing approval_prompt question, approval_default setting, and the pattern for requesting user confirmation for high-risk operations"
                  }
                ],
                "sections": []
              }
            ]
          },
          {
            "heading": "## Example Implementation",
            "level": 2,
            "prompt": "Provide a complete example implementation of a SafetyHook class that demonstrates the hook pattern. Show initialization with config, the on_tool_pre method that checks for blocked commands in bash tool invocations, and returns deny or continue HookResult appropriately.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "While this contract file doesn't contain the SafetyHook example from the amplifier-docs, it provides multiple example patterns throughout (lines 92-109, 118-141, 157-171) that demonstrate hook implementation patterns including handler registration, event handling, and result return patterns that can illustrate complete hook implementations"
              }
            ],
            "sections": []
          },
          {
            "heading": "## Authoritative Reference",
            "level": 2,
            "prompt": "Provide links to authoritative reference documentation: the Hook Contract complete specification and the Hooks API full reference with appropriate GitHub URLs.",
            "sources": [
              {
                "file": "amplifier-core/docs/contracts/HOOK_CONTRACT.md",
                "reasoning": "Lines 40-49 reference HOOKS_API.md as the complete API documentation, and line 318 provides related documentation links to HOOKS_API.md establishing it as the authoritative detailed reference"
              }
            ],
            "sections": []
          }
        ]
      }
    ]
  }
}
